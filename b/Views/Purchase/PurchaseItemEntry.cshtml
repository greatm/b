@using b.ViewModels
@model PagedPurchaseModel

@{
    WebGrid grid = new WebGrid(rowsPerPage: Model.PageSize);
    grid.Bind(Model.PurchaseItems, autoSortAndPage: false, rowCount: Model.TotalRows);
}

<style type="text/css">
    input {
        border: 1px solid #e2e2e2;
        background: #fff;
        color: #333;
        font-size: 1.2em;
        margin: 2px 0 2px 0px;
        padding: 2px;
        width: 170px;
    }
</style>

<script type="text/javascript">

    $(".add").live("click", function () {

        var existrow = $('.save').length;
        if (existrow == 0) {
            var index = $("#grid tbody tr").length + 1;

            var Name = "Name_" + index;
            var Address = "Quantity_" + index;
            var ContactNo = "Rate_" + index;
            var Save = "Save_" + index;
            var Cancel = "Cancel_" + index;

            var tr = '<tr class="alternate-row"><td></td><td><span> <input id="' + Name + '" type="text" /></span></td>' +
                 '<td><span> <input id="' + Quantity + '" type="text" /></span></td>' +
                 '<td><span> <input id="' + Rate + '" type="text" /></span></td>' +
                 '<td> <a href="#" id="' + Save + '" class="save">Save</a><a href="#" id="' + Cancel + '"  class="icancel">Cancel</a></td>' +
             '</tr>';

            $("#grid tbody").append(tr);
        }
        else {
            alert('First Save your previous record !!');
        }

    });

    $(".icancel").live("click", function () {
        var flag = confirm('Are you sure to cancel');
        if (flag) {
            $(this).parents("tr").remove();
        }

    });

    $(".save").live("click", function () {
        var id = $("#grid tbody tr").length;
        var Name = $("#Name_" + id).val();
        var Address = $("#Quantity_" + id).val();
        var ContactNo = $("#Rate_" + id).val();

        if (id != "") {
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '@Url.Action("SaveRecord", "Home")',
                data: { "name": Name, "Qty": Quantity, "Rate": Rate },
                dataType: "json",
                beforeSend: function () { },
                success: function (data) {
                    if (data.result == true) {
                        $("#divmsg").html("Record has been saved successfully !!");
                        setTimeout(function () { window.location.replace("WebGridCRUD"); }, 2000);
                    }
                    else {
                        alert('There is some error');

                    }

                }

            });
        }
    });

    $(".edit").live("click", function () {
        var str = $(this).attr("id").split("_");
        id = str[1];

        var Name = "#Name_" + id;
        var spanName = "#spanName_" + id;
        var Address = "#Quantity_" + id;
        var spanAddress = "#spanQuantity_" + id;
        var ContactNo = "#Rate_" + id;
        var spanContactNo = "#spanRate_" + id;

        $(Name).show();
        $(spanName).hide();
        $(Address).show();
        $(spanAddress).hide();
        $(ContactNo).show();
        $(spanContactNo).hide();

        $(this).hide();
        $("#Update_" + id).show();
        $("#Cancel_" + id).show();
    });

    $(".cancel").live("click", function () {
        var str = $(this).attr("id").split("_");
        id = str[1];

        var Name = "#Name_" + id;
        var spanName = "#spanName_" + id;
        var Address = "#Quantity_" + id;
        var spanAddress = "#spanQuantity_" + id;
        var ContactNo = "#Rate_" + id;
        var spanContactNo = "#spanRate_" + id;

        $(Name).hide();
        $(spanName).show();
        $(Address).hide();
        $(spanAddress).show();
        $(ContactNo).hide();
        $(spanContactNo).show();

        $(this).hide();
        $("#Update_" + id).hide();

        $("#Edit_" + id).show();
    });

    $(".update").live("click", function () {
        var str = $(this).attr("id").split("_");
        id = str[1];

        var Name = $("#Name_" + id).val();
        var spanName = $("#spanName_" + id).val();
        var Address = $("#Quantitiy_" + id).val();
        var spanAddress = $("#spanQuantity_" + id).val();
        var ContactNo = $("#Rate_" + id).val();
        var spanContactNo = $("#spanRate_" + id).val();

        if (id != "") {
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '@Url.Action("UpdateRecord", "Home")',
                data: { "id": id, "name": Name, "Qty": Quantity, "Rate": Rate },
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {

                    if (data.result == true) {
                        $("#Update_" + id).hide();
                        $("#Cancel_" + id).hide();
                        $("#Edit_" + id).show();

                        var Name = "#Name_" + id;
                        var spanName = "#spanName_" + id;
                        var Address = "#Quantity_" + id;
                        var spanAddress = "#spanQuantity_" + id;
                        var ContactNo = "#Rate_" + id;
                        var spanContactNo = "#spanRate_" + id;

                        $(Name).hide();
                        $(spanName).show();
                        $(Address).hide();
                        $(spanAddress).show();
                        $(ContactNo).hide();
                        $(spanContactNo).show();

                        $(spanName).text($(Name).val());
                        $(spanAddress).text($(Address).val());
                        $(spanContactNo).text($(ContactNo).val());
                    }
                    else {
                        alert('There is some error');
                    }
                }

            });
        }
    });

    $(".delete").live("click", function () {
        var str = $(this).attr("id").split("_");
        id = str[1];

        var flag = confirm('Are you sure to delete ??');
        if (id != "" && flag) {
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '@Url.Action("DeleteRecord", "Home")',
                data: { "id": id },
                dataType: "json",
                beforeSend: function () { },
                success: function (data) {

                    if (data.result == true) {
                        $("#Update_" + id).parents("tr").remove();
                    }
                    else {
                        alert('There is some error');
                    }
                }

            });
        }
    });

</script>

<div id="divmsg" style="color: green; font-weight: bold"></div>
<a href="#" class="add">Add New</a>
<br />
<br />
@grid.GetHtml(
htmlAttributes: new { id = "grid" },
    fillEmptyRows: false,
    mode: WebGridPagerModes.All,
    firstText: "<< First",
    previousText: "< Prev",
    nextText: "Next >",
    lastText: "Last >>",
     columns: new[] {
        
        grid.Column("ProductID",header: "ID", canSort: false),
       // grid.Column(header: "Name",format: @<span> <span id="spanName_@item.ProductID">@item.Name</span> @Html.TextBox("Name_"+(int)item.ProductID,(string)item.Name,new{@style="display:none"})</span>),
      
        grid.Column(header: "Quantity",format: @<span> <span id="spanQuantity_@item.ProductID">@item.Quantity</span> @Html.TextBox("Quantity_"+(int)item.ProductID,(int)item.Quantity,new{@style="display:none"})</span>),
        
//grid.Column(header: "Contact No",format: @<span> <span id="spanContactNo_@item.CustID">@item.ContactNo</span> @Html.TextBox("ContactNo_"+(int)item.CustID,(string)item.ContactNo,new{@style="display:none"})</span>),
        grid.Column(header: "Action",format:@<text> <a href="#" id="Edit_@item.ProductID" class="edit">Edit</a><a href="#" id="Update_@item.ProductID" style="display:none" class="update">Update</a><a href="#" id="Cancel_@item.ProductID" style="display:none"  class="cancel">Cancel</a><a href="#" id="Delete_@item.ProductID"  class="delete">Delete</a></text>)
})



@*<div style="width: 95%;">
    @(Html.Syncfusion().Grid<PurchaseItem>("GenericListGrid")
    .Datasource(Model)
    .Caption("hi")
    .EnablePaging()
    .EnableSorting()
    .Column(cols =>
    {
        cols.Add(c => c.ProductID);
        cols.Add(c => c.Qty);
        cols.Add(c => c.Rate);
    })
    )
</div>*@
